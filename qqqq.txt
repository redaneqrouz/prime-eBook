//ouvrir scott
alter user scott account unlock; 

create TABLESPACE smiS643
DATAFILE 'C:\Program Files\Oracle\ayoub.dbf' SIZE 3M
extent management local uniform size 8k
segment space management manual;


//pour avoir les tablespace  :::system
7

//dans le system
GRANT DROP USER TO scott;
GRANT CREATE TABLE TO scott;
GRANT CREATE SESSION TO scott;
GRANT CREATE USER to scott;


//dans le system
GRANT DROP USER TO AYOUB;
GRANT CREATE TABLE TO AYOUB;
GRANT CREATE SESSION TO AYOUB;
GRANT CREATE USER to AYOUB;


CREATE USER serji IDENTIFIED BY serji
DEFAULT TABLESPACE USERS
QUOTA UNLIMITED ON USERS
TEMPORARY TABLESPACE TEMP;

CREATE USER ayoub IDENTIFIED BY ayoub123
DEFAULT TABLESPACE smis64
QUOTA UNLIMITED ON smis64
TEMPORARY TABLESPACE TEMP;

CREATE TABLE ETUDIANT(
NE NUMBER(4) ,
NOM CHAR(30),
ADRESSE VARCHAR2(50),
VILLE CHAR(15),
PRIMARY KEY (NE)
);

CREATE TABLE MATIERE(
NM CHAR(6),
NOM CHAR(15),
COEFFICIENT NUMBER(2),
PRIMARY KEY (NM)
);

CREATE TABLE EVALUATION(
NE NUMBER(4) REFERENCES ETUDIANT(NE),
NM CHAR(6) REFERENCES MATIERE(NM),
DATEEVAL DATE,
NOTE NUMBER(4,2)
);

ALTER TABLE EVALUATION DROP PRIMARY KEY;

INSERT INTO ETUDIANT VALUES(168,'idrissi','bouknadal','Oujda');
INSERT INTO ETUDIANT VALUES(169,'oujdi','bouknadal','Oujda');
INSERT INTO ETUDIANT VALUES(170,'gamallll','laymoun','barkane');


INSERT INTO MATIERE VALUES('1','physique',4); 
INSERT INTO MATIERE VALUES('2','mathe',5);  
INSERT INTO MATIERE VALUES('3','Scien ding',6);   


INSERT INTO EVALUATION VALUES(168,'1','12-10-2014',3);
INSERT INTO EVALUATION VALUES(168,'2','13-10-2014',12);
INSERT INTO EVALUATION VALUES(168,'3','14-10-2014',4);

INSERT INTO EVALUATION VALUES(169,'1','12-10-2014',12);
INSERT INTO EVALUATION VALUES(169,'2','13-10-2014',14);
INSERT INTO EVALUATION VALUES(169,'3','14-10-2014',0);


INSERT INTO EVALUATION VALUES(170,'1','12-10-2014',10);
INSERT INTO EVALUATION VALUES(170,'2','13-10-2014',4);
INSERT INTO EVALUATION VALUES(170,'3','14-10-2014',6);




3)
SELECT *
FROM ETUDIANT;

SELECT *
FROM MATIERE;
4)
SELECT *
FROM ETUDIANT
ORDER BY VILLE DESC;
5)
SELECT DISTINCT VILLE
FROM ETUDIANT;
6)
SELECT NE,NOM,VILLE
FROM ETUDIANT
WHERE VILLE='Oujda';
7)
SELECT *
FROM EVALUATION
ORDER BY DATEEVAL ASC;
8)
SELECT *
FROM MATIERE;

decroiss//

SELECT *
FROM MATIERE
ORDER BY COEFFICIENT DESC;
9)
INSERT INTO ETUDIANT VALUES(171,'ayoub','karawiya','ahfir');
INSERT INTO MATIERE VALUES('4','francais',2);
INSERT INTO EVALUATION VALUES(171,'1','12-10-2014',16);
INSERT INTO EVALUATION VALUES(171,'2','13-10-2014',14);
INSERT INTO EVALUATION VALUES(171,'3','14-10-2014',15);
INSERT INTO EVALUATION VALUES(171,'4','14-10-2014',13);

10)UPDATE ETUDIANT
SET ADRESSE='news_adress',VILLE='new_ville'
where NE=168;

11)UPDATE EVALUATION 
SET  NOTE=20
WHERE NE=169 AND NM=3;

12)
UPDATE EVALUATION
SET NOTE=NOTE+3
WHERE NM=2;
 

13)
DELETE FROM EVALUATION
WHERE NE=168 AND NM=3;

 14)
DELETE FROM EVALUATION
WHERE NOTE<=5;

15)
SELECT ETUDIANT.NE,NOM,EVALUATION.NOTE
FROM ETUDIANT,EVALUATION
WHERE ETUDIANT.NE=EVALUATION.NE;
16)
SELECT ETUDIANT.NOM,EVALUATION.NOTE
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND EVALUATION.NM=MATIERE.NM
AND MATIERE.NM='3';
17)
SELECT  ETUDIANT.NOM,EVALUATION.NOTE
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND EVALUATION.NM=MATIERE.NM
AND ETUDIANT.NE=168;
AND MATIERE.NOM='physique';
18)
SELECT  EVALUATION.NOTE
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND EVALUATION.NM=MATIERE.NM
AND ETUDIANT.VILLE='Oujda'
AND MATIERE.NOM='physique';
19)
SELECT ETUDIANT.NOM,MATIERE.NOM,EVALUATION.NOTE
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND EVALUATION.NM=MATIERE.NM
ORDER BY EVALUATION.NOTE DESC ;
20)
SELECT MAX(NOTE),ETUDIANT.NOM
FROM EVALUATION,ETUDIANT
WHERE EVALUATION.NE=ETUDIANT.NE 
GROUP BY ETUDIANT.NOM
;//on a group by :pour optimiser les information

21)
SELECT MATIERE.NOM,COUNT(NE)
FROM EVALUATION,MATIERE
WHERE MATIERE.NM=EVALUATION.NM AND EVALUATION.NOTE>=10
GROUP BY MATIERE.NOM
;


22)
SELECT ETUDIANT.NOM,COUNT(MATIERE.NM)
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND MATIERE.NM=EVALUATION.NM
AND EVALUATION.NOTE>=10
GROUP BY ETUDIANT.NOM;


23)
select ETUDIANT.NOM,SUM(EVALUATION.NOTE*MATIERE.COEFFICIENT)/SUM(MATIERE.COEFFICIENT) AS moyenneETu
FROM ETUDIANT,EVALUATION,MATIERE
WHERE ETUDIANT.NE=EVALUATION.NE
AND MATIERE.NM=EVALUATION.NM
GROUP BY ETUDIANT.NOM;


//TP2

1)
CREATE VIEW etu_vil
AS SELECT *
FROM ETUDIANT
WHERE VILLE='Oujda';

SELECT *
FROM etu_vil;

DROP VIEW etu_vil;

2)
INSERT INTO etu_vil VALUES(18,'idri','bonada','Oujda');

SELECT *
FROM etu_vil;

3)
CREATE VIEW etu_vil
AS SELECT *
FROM ETUDIANT
WHERE VILLE='Oujda'
WITH CHECK OPTION ;

INSERT INTO etu_vil VALUES(18,'idri','bonada','Oujda');//n'acccept pas ca car barkane != Oujda c ca le role de with check option ;)

4)

CREATE VIEW not_etu 
(nom,moy)
AS SELECT a.NOM,AVG(c.NOTE)  
FROM ETUDIANT a ,EVALUATION c
WHERE a.NE=c.NE 
GROUP BY a.NOM
HAVING AVG(c.NOTE)>=10
with check option
;


//view de NE et la moyenne 
CREATE VIEW num_moy
(NE,MOY)
AS SELECT NE,AVG(NOTE)
from EVALUATION
GROUP BY NE;

SELECT *
FROM not_etu;


5)inert into not_etu values('ayoub',7);



6)//fausse
create view ne_nom_moy
(NOM,NE,MOY)
AS  SELECT  a.NOM,a.NE,n.note
from ETUDIANT a,EVALUATION n
where  a.NE=n.NE
;

select * from ne_nom_moy;
DROP wiew ne_nom_moy;
DROP VIEW ne_nom_moy;

CREATE UNIQUE INDEX ETUD ON
ETUDIANT (NE,NOM,ADRESSE,VILLE);

